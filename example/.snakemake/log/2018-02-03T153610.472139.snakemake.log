Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 1
Rules claiming more threads will be scaled down.
Job counts:
	count	jobs
	1	all
	1	annotate
	3	bwa_map
	1	samtools_merge_bam
	1	samtools_rmdup
	3	samtools_sort_bam
	1	snp_indel_calling
	11

Job 8: ############ start bwa mapping ####################
Reason: Missing output files: mapping/KPGP-00001/KPGP-00001_L3.bam

bwa mem -t 1 -M /DataBase/Human/hg19/refgenome/hg19.fa rawdata/KPGP-00001/KPGP-00001_L3_R1.fq rawdata/KPGP-00001/KPGP-00001_L3_R2.fq | samtools view -b -S -t /DataBase/Human/hg19/refgenome/hg19.fa.fai > mapping/KPGP-00001/KPGP-00001_L3.bam 2>log/KPGP-00001_bwa_map.log
Finished job 8.
1 of 11 steps (9%) done

Job 5: ############## start sorting bam #####################
Reason: Missing output files: mapping/KPGP-00001/KPGP-00001_L3.bam.sort; Input files updated by another job: mapping/KPGP-00001/KPGP-00001_L3.bam

samtools sort -@ 1 -m 4G mapping/KPGP-00001/KPGP-00001_L3.bam -o mapping/KPGP-00001/KPGP-00001_L3.bam.sort 1>log/KPGP-00001_samtools_sort_bam.log 2>&1
Removing temporary output file mapping/KPGP-00001/KPGP-00001_L3.bam.
Finished job 5.
2 of 11 steps (18%) done

Job 10: ############ start bwa mapping ####################
Reason: Missing output files: mapping/KPGP-00001/KPGP-00001_L4.bam

bwa mem -t 1 -M /DataBase/Human/hg19/refgenome/hg19.fa rawdata/KPGP-00001/KPGP-00001_L4_R1.fq rawdata/KPGP-00001/KPGP-00001_L4_R2.fq | samtools view -b -S -t /DataBase/Human/hg19/refgenome/hg19.fa.fai > mapping/KPGP-00001/KPGP-00001_L4.bam 2>log/KPGP-00001_bwa_map.log
Finished job 10.
3 of 11 steps (27%) done

Job 7: ############## start sorting bam #####################
Reason: Missing output files: mapping/KPGP-00001/KPGP-00001_L4.bam.sort; Input files updated by another job: mapping/KPGP-00001/KPGP-00001_L4.bam

samtools sort -@ 1 -m 4G mapping/KPGP-00001/KPGP-00001_L4.bam -o mapping/KPGP-00001/KPGP-00001_L4.bam.sort 1>log/KPGP-00001_samtools_sort_bam.log 2>&1
Removing temporary output file mapping/KPGP-00001/KPGP-00001_L4.bam.
Finished job 7.
4 of 11 steps (36%) done

Job 9: ############ start bwa mapping ####################
Reason: Missing output files: mapping/KPGP-00001/KPGP-00001_L2.bam

bwa mem -t 1 -M /DataBase/Human/hg19/refgenome/hg19.fa rawdata/KPGP-00001/KPGP-00001_L2_R1.fq rawdata/KPGP-00001/KPGP-00001_L2_R2.fq | samtools view -b -S -t /DataBase/Human/hg19/refgenome/hg19.fa.fai > mapping/KPGP-00001/KPGP-00001_L2.bam 2>log/KPGP-00001_bwa_map.log
Finished job 9.
5 of 11 steps (45%) done

Job 6: ############## start sorting bam #####################
Reason: Missing output files: mapping/KPGP-00001/KPGP-00001_L2.bam.sort; Input files updated by another job: mapping/KPGP-00001/KPGP-00001_L2.bam

samtools sort -@ 1 -m 4G mapping/KPGP-00001/KPGP-00001_L2.bam -o mapping/KPGP-00001/KPGP-00001_L2.bam.sort 1>log/KPGP-00001_samtools_sort_bam.log 2>&1
Removing temporary output file mapping/KPGP-00001/KPGP-00001_L2.bam.
Finished job 6.
6 of 11 steps (55%) done

Job 4: ################ merge bam from lanes ###############
Reason: Missing output files: mapping/KPGP-00001/KPGP-00001.sort.merge.bam; Input files updated by another job: mapping/KPGP-00001/KPGP-00001_L3.bam.sort, mapping/KPGP-00001/KPGP-00001_L2.bam.sort, mapping/KPGP-00001/KPGP-00001_L4.bam.sort


        LANE_NUM=3
        if [[ $LANE_NUM -gt 1 ]];
        then 
            samtools merge -l 9 -@ 1 -h mapping/KPGP-00001/KPGP-00001_L2.bam.sort mapping/KPGP-00001/KPGP-00001.sort.merge.bam mapping/KPGP-00001/KPGP-00001_L2.bam.sort mapping/KPGP-00001/KPGP-00001_L3.bam.sort mapping/KPGP-00001/KPGP-00001_L4.bam.sort 1>log/KPGP-00001_samtools_merge_bam.log 2>&1
        else
            mv mapping/KPGP-00001/KPGP-00001_L2.bam.sort mapping/KPGP-00001/KPGP-00001_L3.bam.sort mapping/KPGP-00001/KPGP-00001_L4.bam.sort mapping/KPGP-00001/KPGP-00001.sort.merge.bam
        fi
        
Removing temporary output file mapping/KPGP-00001/KPGP-00001_L3.bam.sort.
Removing temporary output file mapping/KPGP-00001/KPGP-00001_L2.bam.sort.
Removing temporary output file mapping/KPGP-00001/KPGP-00001_L4.bam.sort.
Finished job 4.
7 of 11 steps (64%) done

Job 3: ################ remove duplicates ################
Reason: Missing output files: mapping/KPGP-00001/KPGP-00001_final.bam; Input files updated by another job: mapping/KPGP-00001/KPGP-00001.sort.merge.bam

samtools rmdup -S mapping/KPGP-00001/KPGP-00001.sort.merge.bam mapping/KPGP-00001/KPGP-00001_final.bam  1>log/KPGP-00001_samtools_rmdup.log 2>&1 
Write-protecting output file mapping/KPGP-00001/KPGP-00001_final.bam.
Removing temporary output file mapping/KPGP-00001/KPGP-00001.sort.merge.bam.
Finished job 3.
8 of 11 steps (73%) done

Job 2: ############## call variation #####################
Reason: Missing output files: variation/KPGP-00001_raw_var.vcf; Input files updated by another job: mapping/KPGP-00001/KPGP-00001_final.bam


        samtools mpileup -t DP,AD -q 1 -ugf /DataBase/Human/hg19/refgenome/hg19.fa mapping/KPGP-00001/KPGP-00001_final.bam         | bcftools call -vm -O v -o variation/KPGP-00001_raw_var.vcf 1>log/KPGP-00001_call_var.log 2>&1
        
Write-protecting output file variation/KPGP-00001_raw_var.vcf.
Finished job 2.
9 of 11 steps (82%) done

Job 1: ############## snp_indel annotation ###############
Reason: Missing output files: variation/KPGP-00001.anno.vcf; Input files updated by another job: variation/KPGP-00001_raw_var.vcf


        perl /opt/annovar/convert2annovar.pl -format vcf4 variation/KPGP-00001_raw_var.vcf > variation/KPGP-00001.avinput &&         perl /opt/annovar/annotate_variation.pl variation/KPGP-00001.avinput -buildver hg19 -geneanno         -dbtype refgene /opt/annovar/humandb/ -out variation/KPGP-00001.anno.vcf 1>log/KPGP-00001_annotate.log 2>&1
        
Waiting at most 5 seconds for missing files.
MissingOutputException in line 116 of /home/sxuan/mypipe/example/wgs.py:
Missing files after 5 seconds:
variation/KPGP-00001.anno.vcf
This might be due to filesystem latency. If that is the case, consider to increase the wait time with --latency-wait.
Removing output files of failed job annotate since they might be corrupted:
variation/KPGP-00001.avinput
Will exit after finishing currently running jobs.
Shutting down, this might take some time.
Exiting because a job execution failed. Look above for error message
Complete log: /home/sxuan/mypipe/example/.snakemake/log/2018-02-03T153610.472139.snakemake.log
